# ============================================================
# INTEGRIERTE VARIANTE - Shared Infrastructure
# ============================================================
# Für Umgebungen mit bereits vorhandenen Diensten:
# - Traefik (traefik-proxy Netzwerk)
# - CrowdSec (crowdsec Netzwerk)
# - PostgreSQL/Redis (intern-service Netzwerk)

# ============================================================
# DATENBANK (Shared PostgreSQL)
# ============================================================
# Format: postgresql://user:password@hostname:5432/database
# Hostname = Container-Name im intern-service Netzwerk (meist "postgres")
DATABASE_URL=postgresql://rechnungen_user:DEIN_SICHERES_PASSWORT@postgres:5432/rechnungen

# Setup im PostgreSQL-Container:
# CREATE DATABASE rechnungen;
# CREATE USER rechnungen_user WITH ENCRYPTED PASSWORD 'DEIN_SICHERES_PASSWORT';
# GRANT ALL PRIVILEGES ON DATABASE rechnungen TO rechnungen_user;
# \c rechnungen
# GRANT ALL ON SCHEMA public TO rechnungen_user;

# ============================================================
# SESSION STORAGE
# ============================================================
# VARIANTE 1: File-based (Standard, <1000 User)
SESSION_TYPE=filesystem

# VARIANTE 2: Shared Redis (bei >1000 User oder Multi-Server)
# SESSION_TYPE=redis
# REDIS_URL=redis://redis:6379/5

# Wann Redis?
# - Mehr als 1000 gleichzeitige User
# - Horizontales Scaling (mehrere App-Container)
# - Session-Sharing zwischen Servern

# ============================================================
# SECRETS (NIEMALS IN GIT COMMITTEN!)
# ============================================================
# Generiere neue Secrets mit: openssl rand -hex 32
SECRET_KEY=GENERIERE_EINEN_NEUEN_SECRET_KEY_MIT_OPENSSL
JWT_SECRET_KEY=GENERIERE_EINEN_WEITEREN_SECRET_KEY

# ============================================================
# DOMAIN & TRAEFIK
# ============================================================
DOMAIN=rechnungen.deine-domain.de

# Traefik muss bereits laufen und im traefik-proxy Netzwerk sein!
# CertResolver muss in Traefik konfiguriert sein (z.B. "letsencrypt")

# ============================================================
# FIRMENDATEN (erscheinen auf Rechnungen)
# ============================================================
COMPANY_NAME=Deine Firma GmbH
COMPANY_HOLDER=Max Mustermann
COMPANY_STREET=Musterstraße 123
COMPANY_ZIP=12345
COMPANY_CITY=Musterstadt
COMPANY_COUNTRY=Deutschland
COMPANY_EMAIL=info@deine-firma.de
COMPANY_PHONE=+49 123 456789
COMPANY_TAX_ID=DE123456789
COMPANY_WEBSITE=www.deine-firma.de

# ============================================================
# BANKVERBINDUNG (erscheint auf Rechnungen)
# ============================================================
BANK_NAME=Deine Bank
BANK_IBAN=DE00 0000 0000 0000 0000 00
BANK_BIC=BANKDEFF

# ============================================================
# SMTP (für Passwort-Reset E-Mails)
# ============================================================
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=noreply@deine-firma.de
SMTP_PASSWORD=dein-smtp-passwort
SMTP_USE_TLS=True

# Für Gmail: 2FA aktivieren + App-Passwort erstellen
# https://myaccount.google.com/apppasswords

# ============================================================
# IMAP (optional für Shop-Integration)
# ============================================================
IMAP_SERVER=imap.gmail.com
IMAP_PORT=993
IMAP_USERNAME=shop@deine-firma.de
IMAP_PASSWORD=dein-imap-passwort
IMAP_USE_SSL=true

# ============================================================
# STEUER & BUCHHALTUNG
# ============================================================
DEFAULT_TAX_RATE=19.00

# ============================================================
# 2FA / TOTP
# ============================================================
TOTP_ISSUER_NAME=Rechnungsverwaltung Deine Firma

# ============================================================
# CROWDSEC (optional)
# ============================================================
# Falls CrowdSec im crowdsec-Netzwerk läuft:
# - Logs werden nach /logs geschrieben
# - CrowdSec muss logs/security.log parsen (siehe SETUP_INTEGRATED.md)

# ============================================================
# NOTIZEN
# ============================================================
# 1. Vor Start: docker network create traefik-proxy crowdsec intern-service
# 2. PostgreSQL-DB und User anlegen (siehe oben)
# 3. Secrets generieren (openssl rand -hex 32)
# 4. Deployment: docker-compose -f docker-compose.integrated.yml up -d
# 5. DB initialisieren: docker-compose exec app flask init-db
# 6. Migrationen: docker-compose exec app python migrate_add_*.py
# 7. Admin anlegen: docker-compose exec app flask create-admin
